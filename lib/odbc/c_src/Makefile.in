# ``The contents of this file are subject to the Erlang Public License,
# Version 1.1, (the "License"); you may not use this file except in
# compliance with the License. You should have received a copy of the
# Erlang Public License along with this software. If not, it can be
# retrieved via the world wide web at http://www.erlang.org/.
# 
# Software distributed under the License is distributed on an "AS IS"
# basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See
# the License for the specific language governing rights and limitations
# under the License.
# 
# The Initial Developer of the Original Code is Ericsson Utvecklings AB.
# Portions created by Ericsson are Copyright 1999, Ericsson Utvecklings
# AB. All Rights Reserved.''
# 
#     $Id$
#
include $(ERL_TOP)/make/target.mk
include $(ERL_TOP)/make/$(TARGET)/otp.mk

BINDIR = ../priv/bin/$(TARGET)
OBJDIR = ../priv/obj/$(TARGET)
INCLUDE_DIR= ../include

# ----------------------------------------------------
# Application version
# ----------------------------------------------------
include ../vsn.mk
include $(ERL_TOP)/lib/erl_interface/vsn.mk
VSN=$(ODBC_VSN)

# ----------------------------------------------------
# Release directory specification
# ----------------------------------------------------
RELSYSDIR = $(RELEASE_PATH)/lib/odbc-$(VSN)

# ----------------------------------------------------
# C Target Specs
# ----------------------------------------------------
ifeq ($(findstring win32,$(TARGET)),win32)
MAKEFILE = Makefile.win32.src
MAKE_PREBUILD = Makefile.win32
else
ifeq ($(findstring vxworks,$(TARGET)),vxworks)
MAKEFILE = Makefile.unix.src
MAKE_PREBUILD =
else
MAKEFILE = Makefile.unix.src
MAKE_PREBUILD =
endif
endif

C_FILES = odbcserver.c convert_macros.c

# ----------------------------------------------------
# Target spec
# ----------------------------------------------------

MAKE_TARGET= $(OBJDIR)/Makefile
WIN32_TARGET1 = odbcserver.exe
WIN32_TARGET2 = odbc.hrl


# ----------------------------------------------------
# FLAGS
# ----------------------------------------------------

# ----------------------------------------------------
# Targets
# ----------------------------------------------------

opt: $(MAKE_PREBUILD)
 
debug: $(MAKE_PREBUILD)

clean:
	rm -f core *~ Makefile.win32
ifeq ($(findstring yes,$(TEST)),yes)
else
	rm -f ../priv/bin/$(WIN32_TARGET1) ../include/$(WIN32_TARGET2)
endif

docs:

# ----------------------------------------------------
# Special Build Targets
# ----------------------------------------------------

$(OBJDIR):
	-mkdir -p $(OBJDIR)

$(MAKE_TARGET): $(MAKEFILE)
	@echo " Make a makefile for release"
	sed -e 's;%EI%;erl_interface-$(EI_VSN);' \
	$< > $@

$(MAKE_PREBUILD): $(MAKEFILE)
	@echo " Make a makefile for compiling of odbcserver.c"
	sed -e 's;%EI%;erl_interface;' \
	$< > $@

# ----------------------------------------------------
# Release Target
# ---------------------------------------------------- 
# A release with TARGET=win32 and TEST=yes will not
# compile the odbcserver.c file.

include $(ERL_TOP)/make/otp_release_targets.mk

release_spec: $(APP_TARGET) $(OBJDIR) $(MAKE_TARGET) $(MAKE_PREBUILD)
	$(INSTALL_DIR) $(RELSYSDIR)/src
	$(INSTALL_DATA) $(C_FILES) $(RELSYSDIR)/src
	$(INSTALL_DATA) $(MAKE_TARGET) $(RELSYSDIR)/src
	$(INSTALL_DIR) $(RELSYSDIR)/priv
	$(INSTALL_DIR) $(RELSYSDIR)/priv/bin
	$(INSTALL_DIR) $(RELSYSDIR)/priv/obj
	$(INSTALL_DIR) $(RELSYSDIR)/include
ifeq ($(findstring yes,$(TEST)),yes)
else
ifeq ($(findstring win32,$(TARGET)),win32)
	$(INSTALL_PROGRAM) ../priv/bin/$(WIN32_TARGET1) $(RELSYSDIR)/priv/bin
	$(INSTALL_PROGRAM) ../include/$(WIN32_TARGET2) $(RELSYSDIR)/include
endif
endif

release_docs_spec:

