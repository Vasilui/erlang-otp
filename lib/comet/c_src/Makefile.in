# ``The contents of this file are subject to the Erlang Public License,
# Version 1.1, (the "License"); you may not use this file except in
# compliance with the License. You should have received a copy of the
# Erlang Public License along with this software. If not, it can be
# retrieved via the world wide web at http://www.erlang.org/.
# 
# Software distributed under the License is distributed on an "AS IS"
# basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See
# the License for the specific language governing rights and limitations
# under the License.
# 
# The Initial Developer of the Original Code is Ericsson Utvecklings AB.
# Portions created by Ericsson are Copyright 1999, Ericsson Utvecklings
# AB. All Rights Reserved.''
# 
#     $Id$
#
include $(ERL_TOP)/make/target.mk
include $(ERL_TOP)/make/$(TARGET)/otp.mk

CXX = @CXX@
CC = @CC@
LIBS = @LIBS@


OBJDIR = ../priv/obj/
LIBDIR = ../priv/lib/

# ----------------------------------------------------
# Application version
# ----------------------------------------------------
include ../vsn.mk
VSN=$(COMET_VSN)

# ----------------------------------------------------
# Release directory specification
# ----------------------------------------------------
RELSYSDIR = $(RELEASE_PATH)/lib/comet-$(VSN)

# ----------------------------------------------------
# Target Specs
# ----------------------------------------------------

DLL = erl_com_drv.dll
EXE = erl_com_prog.exe
C_FILES = erl_com_drv.c
H_FILES = erl_com_drv.h # erl_driver.h ei.h eicode.h eiext.h
LIB_FILES = ei.lib erl_dll.lib
WIN_MAKEFILE = Makefile.win32

TARGET_FILES= $(DLL:%=$(LIBDIR)/%) $(EXE:%=$(LIBDIR)/%)
OBJ_FILES= $(C_FILES:%.c=$(OBJDIR)/%.obj)

ALL_CFLAGS = @CFLAGS@ @DEFS@ $(CFLAGS) 

# ----------------------------------------------------
# Targets
# ----------------------------------------------------

ifeq ($(findstring win32,$(TARGET)),win32)
debug opt:
	@echo Built native on Windows
else
debug opt:
	@echo Windows only
endif

clean:
	rm -f $(TARGET_FILES) $(OBJ_FILES)

docs:

# ----------------------------------------------------
# Special Build Targets
# ----------------------------------------------------

# ----------------------------------------------------
# Release Target
# ---------------------------------------------------- 
include $(ERL_TOP)/make/otp_release_targets.mk

release_spec: opt
	$(INSTALL_DIR) $(RELSYSDIR)/priv/lib
	$(INSTALL_PROGRAM) $(TARGET_FILES) $(RELSYSDIR)/priv/lib
	$(INSTALL_DIR) $(RELSYSDIR)/c_src
	$(INSTALL_DATA) $(C_FILES) $(H_FILES) $(RELSYSDIR)/src
	$(INSTALL_DATA) $(WIN_MAKEFILE) $(RELSYSDIR)/src

release_docs_spec:
