<html>
<head>
  <title>Erts Release Notes</title>
  <style type="text/css">
<!--
    body          { background: white; margin: 3em }

    body          { font-family: Verdana, Arial, Helvetica, sans-serif }
    h1 h2 h3 h4   { font-family: Verdana, Arial, Helvetica, sans-serif }
    h1            { font-size: 48 }
    p li          { font-family: Verdana, Arial, Helvetica, sans-serif }
-->
  </style>
</head>

<body bgcolor=white>

<center><h1>Erts Release Notes</h1></center>


<!--- ################################################################# --->

<h2>Erts 5.2</h2>


<!--- ----------------------------------------------------------------- --->

<h3>Fixed errors and malfunctions</h3>

<ul>

  <li>
    Bit syntax matching in the shell used to allow expressions for sizes;
    this is now disallowed just as it is in compiled code.<br>
    (Own Id: OTP-3781)<br>
    (Aux Id: Seq 5004)<p>
  </li>

  <li>
    spawn_opt/4 used 0 as default value for fullsweep_after instead of the
    default value used by spawn/3, and spawn_link/3. This caused all
    processes spawned by spawn_opt/4 (e.g. all gen_servers) to allways use
    fullsweep if the fullsweep_after option wasn't explicitly set.
    spawn_opt/4 has now been changed to use the same default value as
    spawn/3, and spawn_link/3.<br>
    (*** POTENTIAL INCOMPATIBILITY ***)<br>
    (Own Id: OTP-4179)<p>
  </li>

  <li>
    The spawn bifs didn't fail with badarg as they should if the argument
    list wasn't a list; instead, the spawned process immediately exited.
    All spawn BIFs now fail with badarg if they are passed a bad argument
    as argument list. <br> spawn BIFs which take funs as arguments and
    remote spawn BIFs could fail with other errors than badarg when passed
    bad arguments. All spawn BIFs now fail with badarg when they fail due
    to bad arguments.<br>
    (Own Id: OTP-4185)<p>
  </li>

  <li>
    Negative field sizes in construction of binaries using the bit syntax
    would crash the emulator. Corrected.<br>
    (Own Id: OTP-4301)<p>
  </li>

  <li>
    System flags (+ command line arguments) taking values weren't handled
    correctly. If the value and the system flag were separated by
    whitespace some flags didn't work (e.g. +A 10). If multiple system
    flags with their corresponding values were passed, and the flags and
    the values were separated by whitespace, all of these flags were
    replaced by the last one passed. These bugs have now been corrected.<br>
    (Own Id: OTP-4312)<br>
    (Aux Id: OTP-4267, OTP-4313, OTP-4314)<p>
  </li>

  <li>
    The emulator could deadlock on vfork() due to operations performed in
    the child process before exec() (only observed on multi-processor
    machines). This bug has now been fixed.<br>
    (Own Id: OTP-4389)<br>
    (Aux Id: seq7434)<p>
  </li>

  <li>
    When running the instrumented emulator and sl_alloc release 1,
    sl_realloc could fail to preserve all information. This has now been
    fixed.<br>
    (Own Id: OTP-4419)<p>
  </li>

  <li>
    Harmless bug (which caused compilation warnings on some platforms)
    fixed in sl_alloc (release 2)<br>
    (Own Id: OTP-4420)<p>
  </li>

  <li>
    Documentation of obsolete system flag +s removed<br>
    (Own Id: OTP-4421)<p>
  </li>

  <li>
    A bug in <code>file</code> that failed to flush write buffers after
    write errors, for example device full, and caused subsequent writes
    (after repositioning to a still writable position in the file) to write
    invalid data, has been corrected.<br>
    (Own Id: OTP-4505)<p>
  </li>

  <li>
    <p>A bug that causes <code>inet_drv.c</code> not to free prebound
    sockets has been corrected. <p>A bug that caused
    <code>prim_inet:getiflist/1</code> to miss some interfaces has been
    corrected.<br>
    (Own Id: OTP-4508)<p>
  </li>

  <li>
    A bug in the emulator that caused a memory leak if there had been more
    than 1024 ports open, and a port driver called <code>driver_exit</code>
    (A link from process to port was lost), has been corrected.<br>
    (Own Id: OTP-4509)<p>
  </li>

  <li>
    A bug that caused a segfault in the emulator when decoding a bad
    distribution message has been corrected.<br>
    (Own Id: OTP-4510)<p>
  </li>

  <li>
    <p> Comparisons between two <code>port</code>s or between two
    <code>reference</code>s were previously unstable and didn't conform to
    the Erlang specification. Comparisons between two <code>pid</code>s
    didn't previously conform to the Erlang specification. The comparison
    between two <code>pid</code>s, <code>port</code>s, or
    <code>reference</code>s has therefore been changed and is now stable,
    and does now conform to the Erlang specification. </p> <p> Cut from the
    Erlang specification:<br> If <code>t1</code> and <code>t2</code> are
    both refs, both PIDs, or both ports, then <code>t1</code> precedes
    <code>t2</code> if and only if either<br> * <code>node(t1)</code>
    precedes <code>node(t2)</code>, or<br> * <code>node(t1)</code> equals
    <code>node(t2)</code> and <code>t1</code> was created before
    <code>t2</code>. </p><br>
    (*** POTENTIAL INCOMPATIBILITY ***)<br>
    (Own Id: OTP-4511)<p>
  </li>

</ul>


<!--- ----------------------------------------------------------------- --->

<h3>Improvements and new features</h3>

<ul>

  <li>
    The previous hard system limit of 255 known remote nodes has been
    removed. With the exception of node name atoms, all data regarding
    remote nodes are now garbage collected.<br>
    (Own Id: OTP-4196)<p>
  </li>

  <li>
    sl_alloc release 2 has been introduced in the emulator, see the
    sl_alloc(3) man page for more information.<br>
    (Own Id: OTP-4267)<br>
    (Aux Id: seq7276, OTP-4312, OTP-4313, OTP-4314)<p>
  </li>

  <li>
    The format of the monitor messages has been changed. The
    <code>Object</code> field in the <code>{'DOWN', MonitorReference, Type,
    Object, Info}</code> messages is now always on the form
    <code>{RegisteredName, NodeName}</code> when
    <code>erlang:monitor/2</code> has been called with a registered name
    (see erlang(3)).<br>
    (*** POTENTIAL INCOMPATIBILITY ***)<br>
    (Own Id: OTP-4311)<br>
    (Aux Id: Seq7326)<p>
  </li>

  <li>
    More memory block types (most of the existing ones) are now identified
    by the instrumented emulator.<br>
    (Own Id: OTP-4313)<br>
    (Aux Id: OTP-4267, OTP-4312, OTP-4314)<p>
  </li>

  <li>
    Memory blocks in the emulator that are guaranteed never to be removed
    are placed in a special block at the beginning of the emulators heap
    segment if there are space left in it. This special block has been
    called the definite alloc block. The size of the definite alloc block
    can be set with the +d system flag (see the erl(1) manpage) (default
    size is 2 Mb). <br> The tuple {definite_alloc, BlockSize, UsedSize}
    that is part of the list returned from
    erlang:system_info(allocated_areas) can be used to determine how much
    that is used of the definite alloc block.<br>
    (Own Id: OTP-4314)<br>
    (Aux Id: seq7276, OTP-4267, OTP-4312, OTP-4313)<p>
  </li>

  <li>
    A number of sl_alloc improvements have been made. For example, the
    block header field have been shrunk, and some useless features have
    been removed.<br>
    (Own Id: OTP-4343)<br>
    (Aux Id: OTP-4267)<p>
  </li>

  <li>
    There are now two new trace breakpoint types - meta trace and call
    count trace. See erlang:trace_pattern/3 and erlang:trace_info/2.<br>
    (Own Id: OTP-4397)<p>
  </li>

  <li>
    The possibility to use elib_malloc instead of the default (libc) malloc
    has been added. The +m command line switch is used in order to enable
    another malloc than the default (see the erl(1) man page). In order to
    enable elib_malloc use "+m elib".<br>
    (Own Id: OTP-4398)<br>
    (Aux Id: seq7437)<p>
  </li>

  <li>
    There is a new portable hash function, <code>erlang:phash2</code>, that
    distributes small integers better than <code>erlang:phash</code>, and
    is faster for bignums and binaries.<br>
    (Own Id: OTP-4399)<p>
  </li>

  <li>
    The endianess specification 'native' has been added to the bit syntax.
    It will resolve to either big or little endian at load time. It is
    specially useful for communcating with linked-in drivers.<br>
    (Own Id: OTP-4458)<p>
  </li>

  <li>
    The control() routine in a driver called for a port that is set in
    binary mode (using set_port_control_flags()), is now allowed to return
    a NULL pointer instead of a pointer to a binary. A NULL pointer will be
    returned to the caller of port_control/3 as an empty list.<br>
    (Own Id: OTP-4459)<p>
  </li>

</ul>


There are also release notes for
<a href="notes_history.html">older versions</a>.

</body>
</html>
