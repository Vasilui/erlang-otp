<html>
<head>
  <title>Erts Release Notes</title>
  <style type="text/css">
<!--
    body          { background: white; margin: 3em }

    body          { font-family: Verdana, Arial, Helvetica, sans-serif }
    h1 h2 h3 h4   { font-family: Verdana, Arial, Helvetica, sans-serif }
    h1            { font-size: 48 }
    p li          { font-family: Verdana, Arial, Helvetica, sans-serif }
-->
  </style>
</head>

<body bgcolor=white>

<center><h1>Erts Release Notes</h1></center>


<!--- ################################################################# --->

<h2>Erts 5.3</h2>


<!--- ----------------------------------------------------------------- --->

<h3>Fixed errors and malfunctions</h3>

<ul>

  <li>
    The start_erl example script passed parameters to erlexec in an
    incorrect way; this is now corrected.<br>
    (Own Id: OTP-3004)<p>
  </li>

  <li>
    Better error checking of invalid floating point numbers in
    list_to_float/1.<br>
    (Own Id: OTP-4361)<p>
  </li>

  <li>
    The '{active,once}' option for <code>inet:setopts/2</code> is now
    documented.<br>
    (Own Id: OTP-4573)<p>
  </li>


  <li>
    An unneccessary garbage collection at process exit for processes with
    heap fragments is removed.<br>
    (Own Id: OTP-4603)<br>
    (Aux Id: seq7783)<p>
  </li>

  <li>
    The script 'start' now spawns off an run_erl that's completely
    disconnected from the controlling terminal and that ignores sighup
    (run_erl -daemon)<br>
    (Own Id: OTP-4612)<br>
    (Aux Id: seq7644)<p>
  </li>

  <li>
    Some internal memory allocation routines (used in BIFs) would allocate
    more memory than necessary, especially if the default mininum heap size
    had been raised. Corrected.<br>
    (Own Id: OTP-4625)<p>
  </li>

  <li>
    A mixup of read buffers in the inet driver could cause unpredictable
    results when communicating over TCP and for distributed erlang.<br>
    (Own Id: OTP-4626)<br>
    (Aux Id: seq7746)<p>
  </li>

  <li>
    Ets tables could show negative sizes in ets:info after a combination of
    safe_fixtable,delete and insert. The bug is removed.<br>
    (Own Id: OTP-4690)<br>
    (Aux Id: seq7871)<p>
  </li>

  <li>
    process_info(Pid, garbage_collection) didn't return information about
    Pid; instead, it returned information about the calling process. This
    bug has now been corrected.<br>
    (Own Id: OTP-4725)<p>
  </li>

  <li>
    Repeated process_flag(Pid, save_calls, X) calls could cause
    erlang:memory() (and other memory information bifs) to return erroneous
    information. This bug has now been corrected.<br>
    (Own Id: OTP-4731)<br>
    (Aux Id: OTP-4637)<p>
  </li>

  <li>
    ets:memory on set datatype could show wrong result after multiple
    inserts with same key. The error occurs after applying patch erl_487.
    The error is now corrected.<br>
    (Own Id: OTP-4756)<br>
    (Aux Id: OTP-4690, seq8001)<p>
  </li>

</ul>


<!--- ----------------------------------------------------------------- --->

<h3>Improvements and new features</h3>

<ul>

  <li>
    Support for the HW watchdog on the CP_blade board (PPC_LINUX)<br>
    (Own Id: OTP-4520)<p>
  </li>

  <li>
    Support for zombies has been removed. <code>erlang:system_flag/2</code>
    will no longer accept the <code>keep_zombies</code> argument.
    <code>process_info/2</code> will no longer accept the <code>exit</code>
    option (which was used to retrieve the exit reason for a zombie
    process).<br>
    (*** POTENTIAL INCOMPATIBILITY ***)<br>
    (Own Id: OTP-4523)<p>
  </li>

  <li>
    The BIF erlang:hibernate/3 allows a process to shrink its memory
    consumption while waiting for messages.<br>
    (Own Id: OTP-4727)<p>
  </li>

  <li>
    A number of new memory allocators have been introduced in order to
    further reduce the memory consumption of the emulator. In order to
    resemble the Erlang/OTP R9B system, most of these allocators are
    disabled by default in the Erlang/OTP R9C release. By starting the
    emulator with the command-line argument "<code>+Mea r10b</code>", the
    emulator will use the default configuration we currently expect the
    Erlang/OTP R10B emulator to use. See the <code>erts_alloc(3)</code>
    documentation for further information. <br><br> Also new functionality for
    inspection of memory usage has been introduced. See the
    <code>instrument(3)</code>, <code>erlang:system_info/1</code>, and
    <code>erts_alloc(3)</code> documentation for further information. <br><br>
    <em>NOTE:</em> Some system flags (+ command line arguments passed to
    erl) have been changed. The <code>+m</code>, <code>+t</code>, and
    <code>+T</code> flags have been changed to, respectively,
    <code>+MYm</code>, <code>+MYtt</code>, and <code>+MYtp</code>. The
    <code>+d</code>, and <code>+S*</code> flags have been removed. See the
    <code>erts_alloc(3)</code>, and the <code>erl(1)</code> documentation
    for further information.<br>
    (*** POTENTIAL INCOMPATIBILITY ***)<br>
    (Own Id: OTP-4534)<br>
    (Aux Id: OTP-4761)<p>
  </li>

  <li>
    A way to make ets:update_counter wrap at certain values is now
    available. See the documentation for details.<br>
    (Own Id: OTP-4546)<br>
    (Aux Id: seq4605 (body9066))<p>
  </li>

  <li>
    The maximum number of ports can now be changed to an arbitrary value
    using the environment variable ERL_MAX_PORTS on windows, corresponding
    to the behaviour on other operating systems. The maximum number of
    simultaneously open i.e. sockets or port programs is now only limited
    by operating system imposed limits.<br>
    (Own Id: OTP-4578)<p>
  </li>

  <li>
    The beam files contain information about the source filenames unless
    stripped.<br>
    (*** POTENTIAL INCOMPATIBILITY ***)<br>
    (Own Id: OTP-4611)<br>
    (Aux Id: seq7627)<p>
  </li>

  <li>
    A method of getting notifications of long garbage collections, large
    heaps and suspended processes due to busy ports is now available. See
    the documentation of erlang:system_monitor/0..2.<br>
    (Own Id: OTP-4627)<br>
    (Aux Id: seq7772)<p>
  </li>

  <li>
    erlang:memory/0 and erlang:memory/1 have been added.
    erlang:memory/[0,1] return the same type of information as
    c:memory/[0,1] previously did. The erlang:memory/[0,1] functions
    operate in constant time. c:memory/[0,1] now use erlang:memory/[0,1]
    and do therefore now also operate in constant time (which they
    previously did not). <br> erlang:memory/[0,1] return more accurate
    information than c:memory/[0,1] previously did. <br> For more
    information about erlang:memory/[0,1] see the erlang(3) man page.<br>
    (Own Id: OTP-4637)<p>
  </li>

  <li>
    A new class of error messages "warnings" are added. Warnings can be
    mapped to either error reports (the default), Info reports or a new
    class of reports, namely "warning reports". Non severe errors in OTP
    will be reported as warnings instead of forcing error reports.<br>
    (Own Id: OTP-4638)<br>
    (Aux Id: seq7788)<p>
  </li>

  <li>
    The <code>gen_tcp:shutdown/2</code> function has been added. To handle
    shutdown from the other side, the option <code>{exit_on_close,
    true|false}</code> has been added to the <code>inet:setops/2</code>
    function.<br>
    (Own Id: OTP-4664)<p>
  </li>

  <li>
    To give applications better control of conversion of local time to UTC
    with respect to daylight saving time, there are two new functions:
    erlang:localtime_to_universaltime/2 and
    calendar:local_time_to_uinversal_time_dst/1. See the documentation for
    details.<br>
    (Own Id: OTP-4667)<br>
    (Aux Id: seq7797)<p>
  </li>

  <li>
    In order to conform to the Erlang specification, comparison between two
    pids was changed in the R9B release. This change did however break a
    deadlock- prevention algorithm used by mnesia during release upgrade.
    Therefore, comparison between two pids has been changed back so that
    R9B nodes are compatible with Erlang nodes running pre-R9 releases.
    <br> Pre-R9 comparison between two pids which now is used again: If t1
    and t2 are both pids, t1 will precede t2 if and only if either * the
    node local id of t1 precedes the node local id of t2, or * the node
    local ids of t1 and t2 are equal, and node(t1) precedes node(t2), or *
    the node local ids of t1 and t2 are equal, and also node(t1) and
    node(t2) are equal, and node(t1) was created before node(t2). <br> The
    node local id consist of two integers; serial which is most
    significant, and number. <br> The Erlang specification states: If t1
    and t2 are both refs, both PIDs, or both ports, then t1 precedes t2 if
    and only if either * node(t1) precedes node(t2), or * node(t1) equals
    node(t2) and t1 was created before t2. <br> Note that comparisons
    between two refs, or two ports will still conform to the Erlang
    specification.<br>
    (*** POTENTIAL INCOMPATIBILITY ***)<br>
    (Own Id: OTP-4715)<br>
    (Aux Id: OTP-4511, OTP-4512)<p>
  </li>

  <li>
    The <code>erlang:fun_info/2</code> function will now return the name of
    the local function that implements the fun. Also, the
    <code>arity</code> information returned has now been documented.<br>
    (Own Id: OTP-4719)<br>
    (Aux Id: OTP-4704)<p>
  </li>

  <li>
    <p>A http state bug in inet_drv (affecting gen_tcp) has been fixed.
    Patch from Claes Wikström. <p>A bug in defining max number of ports has
    been fixed. Patch from Claes Wikström. <p>A bug in erlang:port_call/3
    when calling a driver with a NULL driver struct ->call field has been
    fixed. Patch from Luke Gorrie. <p>There is a new function
    file:script/1,2 that does the same as file:eval/1 but gives a return
    value. For completness, file:path_script/2,3, file:eval/2 and
    file:path_eval/3 are also added. Suggestion from Ulf Wiger. See the
    documentation for details. <p><code>erlang:trace/3</code> did no clear
    trace flags on processes that were exiting. This bug has now been
    fixed. <p>The gen_udp options <code>add_membership</code> and
    <code>drop_membership</code> are now allowed. Patch from Vance Shipley.
    <p><code>gen_udp:open/1,2</code> with service name instead of port
    number now works. Patch from carlos@lfcia.org. <p>An unjustified
    compiler warning when using an explicit space character as pad
    character to <code>io:format/2</code> and similar has been removed.
    <p>If an illegal node name is used to start a node, now
    <code>net_kernel</code> fails noisily instead of just letting the node
    start in non-distributed mode. <p>Now
    <code>gen_server:format_status/2</code> also works with non-registered
    processes. <p>There are two new functions
    <code>erlang:list_to_integer/2</code> and
    <code>erlang:integer_to_list/2</code> that takes a number base
    argument. See the documentataion for details. <p>New format characters
    for <code>io:format/2</code> and similar are ~b, ~B, ~x, ~X, ~+ and ~#.
    See the documentaion for details. <p>New format characters for
    <code>io:fread/2</code> and similar are ~u, ~- and ~#. See the
    documentation for details. <p>The token scanner <code>erl_scan</code>
    has been rewritten to become twice as fast as before. Now, incomplete
    any-base numbers such as "16#" are regarded as errors instead of as
    zero. The allowed base number range has been extended to 2..36 instead
    of previously 2..16. <p>There is a new function
    <code>lists:split/2</code>. See the documentation. <p>For everyone that
    has written their own function to calculate the time difference between
    two <code>now()</code> calls there is now
    <code>timer:now_diff/2</code>. See the documentation.<br>
    (Own Id: OTP-4747)<p>
  </li>

</ul>


<!--- ################################################################# --->

<h2>Erts 5.2</h2>


<!--- ----------------------------------------------------------------- --->

<h3>Fixed errors and malfunctions</h3>

<ul>

  <li>
    Bit syntax matching in the shell used to allow expressions for sizes;
    this is now disallowed just as it is in compiled code.<br>
    (Own Id: OTP-3781)<br>
    (Aux Id: Seq 5004)<p>
  </li>

  <li>
    spawn_opt/4 used 0 as default value for fullsweep_after instead of the
    default value used by spawn/3, and spawn_link/3. This caused all
    processes spawned by spawn_opt/4 (e.g. all gen_servers) to allways use
    fullsweep if the fullsweep_after option wasn't explicitly set.
    spawn_opt/4 has now been changed to use the same default value as
    spawn/3, and spawn_link/3.<br>
    (*** POTENTIAL INCOMPATIBILITY ***)<br>
    (Own Id: OTP-4179)<p>
  </li>

  <li>
    The spawn bifs didn't fail with badarg as they should if the argument
    list wasn't a list; instead, the spawned process immediately exited.
    All spawn BIFs now fail with badarg if they are passed a bad argument
    as argument list. <br> spawn BIFs which take funs as arguments and
    remote spawn BIFs could fail with other errors than badarg when passed
    bad arguments. All spawn BIFs now fail with badarg when they fail due
    to bad arguments.<br>
    (Own Id: OTP-4185)<p>
  </li>

  <li>
    Negative field sizes in construction of binaries using the bit syntax
    would crash the emulator. Corrected.<br>
    (Own Id: OTP-4301)<p>
  </li>

  <li>
    System flags (+ command line arguments) taking values weren't handled
    correctly. If the value and the system flag were separated by
    whitespace some flags didn't work (e.g. +A 10). If multiple system
    flags with their corresponding values were passed, and the flags and
    the values were separated by whitespace, all of these flags were
    replaced by the last one passed. These bugs have now been corrected.<br>
    (Own Id: OTP-4312)<br>
    (Aux Id: OTP-4267, OTP-4313, OTP-4314)<p>
  </li>

  <li>
    The emulator could deadlock on vfork() due to operations performed in
    the child process before exec() (only observed on multi-processor
    machines). This bug has now been fixed.<br>
    (Own Id: OTP-4389)<br>
    (Aux Id: seq7434)<p>
  </li>

  <li>
    When running the instrumented emulator and sl_alloc release 1,
    sl_realloc could fail to preserve all information. This has now been
    fixed.<br>
    (Own Id: OTP-4419)<br>
    (Aux Id: OTP-4570)<p>
  </li>

  <li>
    Harmless bug (which caused compilation warnings on some platforms)
    fixed in sl_alloc (release 2)<br>
    (Own Id: OTP-4420)<p>
  </li>

  <li>
    Documentation of obsolete system flag +s removed<br>
    (Own Id: OTP-4421)<p>
  </li>

  <li>
    A bug in <code>file</code> that failed to flush write buffers after
    write errors, for example device full, and caused subsequent writes
    (after repositioning to a still writable position in the file) to write
    invalid data, has been corrected.<br>
    (Own Id: OTP-4505)<br>
    (Aux Id: OTP-4500)<p>
  </li>

  <li>
    <p>A bug that causes <code>inet_drv.c</code> not to free prebound
    sockets has been corrected. <p>A bug that caused
    <code>prim_inet:getiflist/1</code> to miss some interfaces has been
    corrected.<br>
    (Own Id: OTP-4508)<p>
  </li>

  <li>
    A bug in the emulator that caused a memory leak if there had been more
    than 1024 ports open, and a port driver called <code>driver_exit</code>
    (A link from process to port was lost), has been corrected.<br>
    (Own Id: OTP-4509)<p>
  </li>

  <li>
    A bug that caused a segfault in the emulator when decoding a bad
    distribution message has been corrected.<br>
    (Own Id: OTP-4510)<p>
  </li>

</ul>


<!--- ----------------------------------------------------------------- --->

<h3>Improvements and new features</h3>

<ul>

  <li>
    The previous hard system limit of 255 known remote nodes has been
    removed. With the exception of node name atoms, all data regarding
    remote nodes are now garbage collected.<br>
    (Own Id: OTP-4196)<p>
  </li>

  <li>
    sl_alloc release 2 has been introduced in the emulator, see the
    sl_alloc(3) man page for more information.<br>
    (Own Id: OTP-4267)<br>
    (Aux Id: seq7276, OTP-4312, OTP-4313, OTP-4314)<p>
  </li>

  <li>
    The format of the monitor messages has been changed. The
    <code>Object</code> field in the <code>{'DOWN', MonitorReference, Type,
    Object, Info}</code> messages is now always on the form
    <code>{RegisteredName, NodeName}</code> when
    <code>erlang:monitor/2</code> has been called with a registered name
    (see erlang(3)).<br>
    (*** POTENTIAL INCOMPATIBILITY ***)<br>
    (Own Id: OTP-4311)<br>
    (Aux Id: Seq7326)<p>
  </li>

  <li>
    More memory block types (most of the existing ones) are now identified
    by the instrumented emulator.<br>
    (Own Id: OTP-4313)<br>
    (Aux Id: OTP-4267, OTP-4312, OTP-4314)<p>
  </li>

  <li>
    Memory blocks in the emulator that are guaranteed never to be removed
    are placed in a special block at the beginning of the emulators heap
    segment if there are space left in it. This special block has been
    called the definite alloc block. The size of the definite alloc block
    can be set with the +d system flag (see the erl(1) manpage) (default
    size is 2 Mb). <br> The tuple {definite_alloc, BlockSize, UsedSize}
    that is part of the list returned from
    erlang:system_info(allocated_areas) can be used to determine how much
    that is used of the definite alloc block.<br>
    (Own Id: OTP-4314)<br>
    (Aux Id: seq7276, OTP-4267, OTP-4312, OTP-4313)<p>
  </li>

  <li>
    A number of sl_alloc improvements have been made. For example, the
    block header field have been shrunk, and some useless features have
    been removed.<br>
    (Own Id: OTP-4343)<br>
    (Aux Id: OTP-4267)<p>
  </li>

  <li>
    There are now two new trace breakpoint types - meta trace and call
    count trace. See erlang:trace_pattern/3 and erlang:trace_info/2.<br>
    (Own Id: OTP-4397)<p>
  </li>

  <li>
    The possibility to use elib_malloc instead of the default (libc) malloc
    has been added. The +m command line switch is used in order to enable
    another malloc than the default (see the erl(1) man page). In order to
    enable elib_malloc use "+m elib".<br>
    (Own Id: OTP-4398)<br>
    (Aux Id: seq7437)<p>
  </li>

  <li>
    There is a new portable hash function, <code>erlang:phash2</code>, that
    distributes small integers better than <code>erlang:phash</code>, and
    is faster for bignums and binaries.<br>
    (Own Id: OTP-4399)<p>
  </li>

  <li>
    The endianess specification 'native' has been added to the bit syntax.
    It will resolve to either big or little endian at load time. It is
    specially useful for communcating with linked-in drivers.<br>
    (Own Id: OTP-4458)<p>
  </li>

  <li>
    The control() routine in a driver called for a port that is set in
    binary mode (using set_port_control_flags()), is now allowed to return
    a NULL pointer instead of a pointer to a binary. A NULL pointer will be
    returned to the caller of port_control/3 as an empty list.<br>
    (Own Id: OTP-4459)<p>
  </li>

  <li>
    <p> Comparisons between two <code>port</code>s or between two
    <code>reference</code>s were previously unstable and didn't conform to
    the Erlang specification. Comparisons between two <code>pid</code>s
    didn't previously conform to the Erlang specification. The comparison
    between two <code>pid</code>s, <code>port</code>s, or
    <code>reference</code>s has therefore been changed and is now stable,
    and does now conform to the Erlang specification. </p> <p> Cut from the
    Erlang specification:<br> If <code>t1</code> and <code>t2</code> are
    both refs, both PIDs, or both ports, then <code>t1</code> precedes
    <code>t2</code> if and only if either<br> * <code>node(t1)</code>
    precedes <code>node(t2)</code>, or<br> * <code>node(t1)</code> equals
    <code>node(t2)</code> and <code>t1</code> was created before
    <code>t2</code>. </p><br>
    (*** POTENTIAL INCOMPATIBILITY ***)<br>
    (Own Id: OTP-4511)<p>
  </li>

</ul>


There are also release notes for
<a href="notes_history.html">older versions</a>.

</body>
</html>
